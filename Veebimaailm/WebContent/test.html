<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=9" />
	<meta name="viewport" content="width=device-width" />
    <title>Avaleht</title>
    <script src="jquery-1.9.1.js"></script>
    <style media="screen" type="text/css">
		ul li{
   			position: relative
		}
		#loginform {
			border-style: outset;
			border-width: 3px;
			border-color: green;
		    position: absolute;
		    display: none;
		}
	</style>
	<script type="text/javascript">
		$(document).ready(function(){
			$("#login").hover(function() {
				$("#loginform").toggle(); 
		    });
			$.getJSON('/server/VerifyLogin', function(data) {
				$("#logform").empty();
				if (data.result=="success") {
					var form = '<form action="/server/VerifyLogin" id="loginform" method="post" accept-charset="utf-8">'
	        		 	 + '<div id="namefield" style="text-transform:capitalize;"> Nimi: <b>'+data.username+'</b></div>'
	         	     	 + '<input type="submit" name="Submit" value="Logi Välja"><br/>' 
	     			 	 + '</form>';
					$("#logform").append(form);
					$("#loginform").submit(function(event) {
						event.preventDefault();
						$.post("/server/VerifyLogin", { "logout": 5433 }, function(data) {
							window.location.reload();
						});
					});
				} else {
					var form = '<form action="/server/VerifyLogin" id="loginform" method="post" accept-charset="utf-8">'
		        		 	 + '<label for="username">Kasutajanimi: </label>'
		         	     	 + '<input type="text" name="username" id="username"/><br/>'
		         	     	 + '<label for="password">Parool: </label>'  
		         	     	 + '<input type="password" name="userpass" id="userpass"/><br/>'
		         	     	 + '<label for="key">Registreerimisvõti: </label>'
		         	     	 + '<input type="text" name="key" id="key"/><br/>'
		         	     	 + '<input type="submit" name="Submit" value="Meldi"><br/>' 
		     			 	 + '</form>';
		     		$("#logform").append(form);
		     		$("#loginform").submit(function(event) {
						event.preventDefault();
						var username = $("#username").val();
						var password = $("#userpass").val();
						var registry_key = $("#key").val();
						if (registry_key.length==0) {
							var request = { "username": username, "password": password };		
						} else {
							var request = { "username": username, "password": password,"key":registry_key };
						}
						$.post("/server/VerifyLogin", request, function(data) {
							if (data.result=="success") {
								window.location.reload();
							} else {
								alert(data.error_code);
							}
						});
					});
				}
			});
			
		});
	</script>
</head>

<body>
<div id="lfogin">
        <p>Logi sisse ID-kaardiga</p>
        <div id="login">
	        <a href="#gsdgs">
	            <img id="somepic" src="images/idkaart.gif" alt="Vajuta siia" />
	        </a>
        	<div id="logform">
		        
     		</div>
        </div>
    </div>
<!--<script>
var somevar = {"action":"vote",
			   "person_id":3,
			   "candidate_id":2 }
	$.ajax({
		type: "POST",
		url: "http://localhost:8080/server/Vote",
		// The key needs to match your method's input parameter (case-sensitive).
		data: JSON.stringify(somevar),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
		success: function(data){alert(data.action);},
		failure: function(errMsg) {
			alert(errMsg);
		}
	});
	
</script>-->
</body>

</html> 